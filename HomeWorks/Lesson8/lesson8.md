 
1. Создал кластер, по:
   ```shell
   pg_createcluster --start --start-conf=manual 14 main
   ```
   Опция `--start-conf=manual` нужна осознанно, ниже будет скриптоваться процесс перезапуска кластера, от не привилегированного пользователя ОС-и.
   Иначе - пропишется в системный ферймворк обслуживания сервисов, и будет требовать работать ч/з фреймворк.
   ![8_1](/HomeWorks/Lesson8/8_1.png)
2. Применил параметры из файла указанного в ДЗ:
   ![8_2](/HomeWorks/Lesson8/8_2.png)
   Кстати, только тут сообразил что в пг - настройки задаваемые для кластера: действуют, одинаковые, во всех субд, созданных в кластере.
   Что может быть не удобно, в oracle, в мультитенант-архитектуре, сделано более продвинуто: плаггабле-базы, в контейнерной бд могут и имеют свои собственные настройки, своё ундо, свои темп-ы, свои настройки оптимизатора, pga-области, свои настройки служебных процессов.
   Дополнительно выставил, в конфиге кластера - `log_min_messages = debug1` ([дока](https://www.postgresql.org/docs/current/runtime-config-logging.html)): удобно, в логе кластера, наблюдать за сессиями запуска автовакуума:
   ![8_3](/HomeWorks/Lesson8/8_3.png)
3. Начиная с пункта ДЗ: `pgbench -i postgres` начал выполнять ДЗ с отклонениями от буквы ДЗ.
   По команде `pgbench -i postgres` - создаётся не очень подходящая табличная модель, для ловли каких то заметных эффектов, связанных с удачной/не удачной настройкой процесса вакуумировия.
   Таблиц - мало, таблицы - маленькие и таблицы очень разные по размеру: одна таблица - на порядки больше чем всё остальное.
   ![8_4](/HomeWorks/Lesson8/8_4.png)
   Учитывая что автовакуум выделяет на обработку таблицы - один процесс, получается что, по факту, речь тут будет идти только о обработке таблицы `pgbench_accounts`.
   Обработка остального - пренебрежимо мала, по затратам.
   Сканирования этого набора таблиц, даже если там будет большой процент мёртвых туплов, при таких размерах табличных сегментов данных - будет не заметен, скорее всего - прокешируется либо в шаред-буферах пг и/или в файловом кеше ОС-и.
   И тут надо будет очень интенсивно читать эти таблицы, чтобы заметить какую то разницу, которая возникает при деградировании качества чтения данных из этих структур
   В общем сделал так - `pgbench -i -s 20 -n --foreign-keys --fillfactor=50 bmdb`:
   ![8_5](/HomeWorks/Lesson8/8_5.png)
   Т.е., с учётом кол-ва памяти в вм (4G) и конфигурации пг, под файловый кэш ОС-и - остаётся немного, относительно вот этих размеров.
   Т.е. вот эти таблицы: точно в память не впишутся, полностью.
   Т.е. субд, обрабатывая sql-команды, подразумевающие фулл-скан таблицы (а только тогда эффекты от наличия какого то процента мёртвых туплов начинают негативить) - будет гонять на диск, за данными и вот тут появление и рост процента мёртвых туплов - должен значительно сильнее вызывать деградацию в латеси по доступу к данынми.
   Второй момент - заказал создание внешних ключей.
   Оно их, обратил внимание - создаёт без индексов, на столбец, являющийся внешним ключём, например:
   ![8_6](/HomeWorks/Lesson8/8_6.png)
   Вообще говоря: fk без индекса, это, конечно есть ересь и вредительство. 
   Но в данном случае это даже к лучшему - удаления строк в мастер-таблице: будут приводить либо к пробивке null-ов, в соотв-х строках дочерней таблицы, либо к удалению этих строк - а чтобы их, без индекса, найти - фуллскан.
   Вставка новой строки, изменение fk-поля, в дочерней таблице - базе надо будет бегать по мастер-таблице, по домену значений столбца, на который смотрит fk-контрейнт, с дочерней таблицы.
   Тут, конечно, будет скан индексной стр-ры, но всё таки: чуть больше чтений и индексы, насколько я понимаю, обязаны создавать и вести какие то индексные элементы смотрящие на мёртвые туплы (мало ли какая долгая транзакция есть и работает и захочет доступ к строкам, по заиндексированному столбцу, которые вчера были удалены) и вставлять новые индексные элементы для обновлённых/вновь созданных строк.
   В общем индексы должны, от транзакций фрагментироваться и накапливать версии индексных элементов ещё бодрее, чем таблицы копят версии строк, от транзакций.
   Т.е. с форенкеями, опять же, эффекты, от версионирования транзакциями строк, негативно влияющие на пропускную способность субд по транзакциям/ед. времени - долджны усиливаться.
   

   
   
